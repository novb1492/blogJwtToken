<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script  src="http://code.jquery.com/jquery-latest.min.js"></script>
  
  
    <title>Document</title>
</head>
<body>
    home
    <div sec:authorize="isAuthenticated()"><!--else문을 모르겠다-->
        <div sec:authentication="name"></div>
    </div>
    <input type="button" onclick="goNaverLogin()" value="네이버 로그인">
    <input type="button" onclick="getlocal()" value="ㅅㄷㄴㅅ">
    <input type="button" onclick="doDo()" value="logintest">
<script>
    function doajax(url,data,contentType){
    var xhr = new XMLHttpRequest(); //new로 생성
    xhr.open('POST', url); 
    xhr.setRequestHeader("Content-Type",contentType);////이게없으면 psot전송불가 조금 찾았네
    xhr.send(data); /// ajax data부분
    return xhr;
}
    var data=JSON.stringify({"email":"kim@kim.com","pwd":"1111"});
function doDo(){
	 var xhr,url='http://localhost:8080/login'
	    var contentType="application/json";
	    xhr=doajax(url,data,contentType);
	    xhr.onload=function(){
	        if(xhr.status==200){
	            jwt=xhr.getResponseHeader('Authorization');
	            refresh=xhr.getResponseHeader('refreshToken');
	            localStorage.setItem('Authorization', jwt);
	           	SetCookie('refresh', '1234');
	        }
	    }
}
    function getlocal(){
    $.ajax({
        url:'/auth/index2',
        type: 'GET',
        xhrFields: {
          withCredentials: true
        },

        success: function(data) {
        },
        error: function(jqXHR, textStatus, errorThrown)
        {
          console.log(jqXHR,textStatus,errorThrown);
        }
      })
}
function goNaverLogin(){
    var xhr = new XMLHttpRequest(); //new로 생성
    xhr.open('POST', '/auth/naver', true); //j쿼리 $ajax.({type,url},true가 비동기)
    xhr.send(); /// ajax data부분
    xhr.onload = function() { 
        if(xhr.status==200){ // success:function(data)부분 통신 성공시 200반환
            location.href=xhr.response;
           
        }else{
            alert('통신에 실패했습니다');
        }
    }  
}
   
</script>
</body>
</html>